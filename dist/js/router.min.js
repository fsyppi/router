!function(t){function e(){this.handlers={}}function o(t){e.apply(this),this.elemSearch=document.getElementById(t),this.elemSearch.addEventListener("keyup",t=>this.handler(t))}function n(t,o,n){e.apply(this),this.ymaps=t,this.map=new t.Map(o,n),this.pointsCollection=this.createCollectionPoints(),this.linesCollection=this.createCollectionLines(),this.createLine()}function i(t){e.apply(this),this.list=document.getElementById(t),this.list.addEventListener("click",t=>this.remove(t))}function r(t){e.apply(this),this.list=document.getElementById(t),this.list.addEventListener("mousedown",t=>this.mouseDown(t)),this.list.addEventListener("mouseup",t=>this.mouseUp(t)),this.list.addEventListener("dragstart",t=>this.dragStart(t)),this.list.addEventListener("dragenter",t=>this.dragEnter(t)),this.list.addEventListener("dragover",t=>this.dragOver(t)),this.list.addEventListener("dragleave",t=>this.dragLeave(t)),this.list.addEventListener("drop",t=>this.drop(t)),this.list.addEventListener("dragend",t=>this.dragEnd(t))}e.prototype.on=function(t,e){this.handlers[t]||(this.handlers[t]=[]),this.handlers[t].push(e)},e.prototype.emit=function(t,...e){let o;if(this.handlers[t])return this.handlers[t].forEach(t=>{o=t(...e)}),o},o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.prototype.handler=function(t){if(13===t.keyCode){let e=t.target;""!==e.value&&(this.emit("submit",e.value),e.value="")}},n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.dragHandler=function(t){let e=t.get("target"),o=this.pointsCollection.indexOf(e),n=e.geometry.getCoordinates();this.linesCollection.get(0).geometry.set(o,n)},n.prototype.createCollectionPoints=function(){let t=new this.ymaps.GeoObjectCollection;return t.events.add("drag",this.dragHandler,this),this.map.geoObjects.add(t),t},n.prototype.createPoint=function(t,e){let o=new this.ymaps.GeoObject({geometry:{type:"Point",coordinates:t},properties:{iconContent:e,balloonContent:e}},{draggable:!0,preset:"islands#violetStretchyIcon"});this.pointsCollection.add(o),this.emit("add",o.properties.get("iconContent"))},n.prototype.createCollectionLines=function(){let e=new t.GeoObjectCollection;return this.map.geoObjects.add(e),e},n.prototype.createLine=function(){let t=new this.ymaps.GeoObject({geometry:{type:"LineString",coordinates:[]}},{strokeColor:"#FF0000",strokeWidth:3});this.linesCollection.add(t)},n.prototype.insertPointIntoLine=function(){let t=this.pointsCollection.getLength()-1,e=this.pointsCollection.get(t).geometry.getCoordinates();this.linesCollection.get(0).geometry.insert(t,e)},n.prototype.newPoint=function(t){this.ymaps.geocode(t).then(e=>{let o,n=e.geoObjects.get(0);o=n?n.geometry.getCoordinates():this.map.getCenter(),this.map.setCenter(o),this.createPoint(o,t),this.insertPointIntoLine()},function(t){console.log("Ошибка")})},n.prototype.removePoint=function(t){this.linesCollection.get(0).geometry.remove(t),this.pointsCollection.remove(this.pointsCollection.get(t))},n.prototype.exchange=function(t,e){let o=this.pointsCollection.get(t),n=this.pointsCollection.get(e);this.pointsCollection.add(o,e),this.pointsCollection.add(n,t),this.linesCollection.get(0).geometry.splice(t,1,n.geometry.getCoordinates()),this.linesCollection.get(0).geometry.splice(e,1,o.geometry.getCoordinates())},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.add=function(t){let e=document.createElement("li");e.innerHTML=t+'<a class="button"></a>',this.list.appendChild(e)},i.prototype.remove=function(t){if(t.target.classList.contains("button")){let e=t.target.parentNode;this.emit("remove",this.getIndex(e)),this.list.removeChild(e)}},i.prototype.getIndex=function(t){let e=t.nextSibling,o=1;for(;e;)e=e.nextSibling,o++;return this.list.childNodes.length-o},i.prototype.change=function(t,e){this.emit("exchange",this.getIndex(t),this.getIndex(e))},r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.mouseDown=function(t){1===t.which&&t.target.parentNode===this.list&&(t.target.draggable=!0,t.target.classList.toggle("draggable"))},r.prototype.mouseUp=function(t){this.removeAttr(t.target)},r.prototype.dragStart=function(t){let e=t.target;if(e.parentNode!==this.list)return void t.preventDefault();let o=t.dataTransfer;o.setData("Text",e.innerHTML),o.effectAllowed="copyMove"},r.prototype.dragEnter=function(t){t.target.parentNode!==this.list||t.target.draggable||(t.target.classList.toggle("dropzone"),t.preventDefault())},r.prototype.dragOver=function(t){t.target.parentNode!==this.list||t.target.draggable||t.preventDefault()},r.prototype.dragLeave=function(t){t.target.parentNode!==this.list||t.target.draggable||t.target.removeAttribute("class")},r.prototype.drop=function(t){let e=t.target,o=document.getElementsByClassName("draggable")[0];t.preventDefault(),e.removeAttribute("class"),o.innerHTML=e.innerHTML,e.innerHTML=t.dataTransfer.getData("Text"),this.emit("change",o,e)},r.prototype.dragEnd=function(t){this.removeAttr(t.target)},r.prototype.removeAttr=function(t){t.parentNode===this.list&&(t.removeAttribute("draggable"),t.removeAttribute("class"))},t.ready(function(){let e=new n(t,"map",{center:[51.66082,39.200404],zoom:5,type:"yandex#hybrid"}),s=new o("search-point"),a=new i("list-points"),l=new r("list-points");e.on("add",a.add.bind(a)),s.on("submit",e.newPoint.bind(e)),a.on("remove",e.removePoint.bind(e)),a.on("exchange",e.exchange.bind(e)),l.on("change",a.change.bind(a))})}(ymaps);